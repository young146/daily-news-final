# 🇻🇳 씬짜오베트남 데일리 뉴스 시스템 인계 문서 (2025-12-27)

이 문서는 씬짜오베트남 데일리 뉴스 자동화 시스템의 성격, 워크플로우, 파일 구조 및 현재 진행 상황을 다음 작업자가 즉시 파악할 수 있도록 정리한 것입니다.

## 1. 프로젝트 성격 (Project Nature)
이 시스템은 베트남 교민 잡지 '씬짜오베트남'의 뉴스 서비스를 자동화하는 시스템입니다.
- **Backend/Admin**: Next.js (App Router)를 사용하여 뉴스 수집, GPT 번역, 관리자 콘솔, 카드뉴스 생성을 담당합니다.
- **Display**: WordPress 테마 내에 설치된 `Jenny Daily News Display` 플러그인이 데이터를 받아 독자에게 보여줍니다.
- **동기화**: 관리자 콘솔에서 변경한 내용(카테고리, 탑뉴스 지정)은 WordPress REST API를 통해 실시간으로 동기화됩니다.

## 2. 핵심 아키텍처 및 데이터 플로우 (Architecture & Data Flow)

### 🕒 시간대 원칙
- 모든 시스템은 **"Asia/Ho_Chi_Minh" (베트남 시간, UTC+7)**을 기준으로 작동합니다.
- 서버와 클라이언트 간의 날짜 불일치를 방지하기 위해 `toLocaleDateString` 사용 시 타임존을 명시합니다.

### 📅 "오늘"의 정의 (Board Date Logic)
- 이 시스템에서 "오늘"은 달력상의 오늘이 아니라 **"가장 최근에 뉴스가 발행된 날짜"**를 의미합니다.
- 뉴스 게시판(Jenny)은 가장 최근 발행일의 기사들을 우선 보여주며, 기사가 부족할 경우(카테고리당 10개 미만) 과거 기사로 빈자리를 채웁니다.

### 🔥 탑뉴스 스트림 (Top News Stream)
- 탑뉴스는 날짜에 구속되지 않는 **"최신 상위 2개 뉴스"**의 스트림입니다.
- 새로운 기사를 탑뉴스로 지정하면, 기존의 탑뉴스 중 가장 오래된 것이 자동으로 해제(Auto Push-back)됩니다.

## 3. 주요 파일 및 역할 (Key Modules)

| 경로 | 역할 |
|------|------|
| `app/admin/actions.js` | 탑뉴스 토글, 카테고리 변경, WordPress 메타 데이터 동기화 등 서버 액션 |
| `app/api/published-news/route.js` | 관리자 콘솔의 '발행 뉴스 관리' 목록 제공 (최근 2회 발행분 유지) |
| `wordpress-plugin/jenny-daily-news.php` | WordPress 게시판 출력 로직 및 **전용 데이터 수신함(Express Lane)** 포함 |
| `lib/card-generator.js` | Canvas 기반 카드뉴스 이미지 생성 (나눔고딕, 나눔명조 폰트 사용) |
| `lib/publisher.js` | WordPress 포스트 발행 및 이미지 업로드 핵심 로직 |

## 4. 금일 작업 내용 (2025-12-27 시행 사항)

### ✅ 탑뉴스 동기화 문제 근본적 해결
- **문제**: 탑뉴스 지정 시 워드프레스(Jenny) 화면에 즉각 반영되지 않는 현상.
- **해결 (Senior Approach)**:
  - **일반 통로 복구**: 워드프레스 표준 REST API가 커스텀 필드 수정을 거부했던 원인인 `auth_callback` 누락을 보완. 이제 인위적인 '특별 통로' 없이 표준 API만으로 모든 데이터가 물 흐르듯 전달됩니다.
  - **불필요한 장치 제거**: `!important` 남발 및 커스텀 엔드포인트를 모두 철거하고, 시스템의 표준 흐름을 따르도록 재설계.

### ✅ 관리자 콘솔 목록 정상화
- '오늘 발행된 뉴스 관리' 섹션이 비어 보이던 문제 해결.
- 시스템 정보의 날짜 계산 방식과 동일하게 "최근 2회의 실제 발행일" 기사들을 모두 가져오도록 쿼리 수정.

### ✅ 카드뉴스 디자인 개편
- SNS 가시성을 높이기 위해 상단 헤더바(붉은색), 하단 블루 라인 추가.
- 나눔고딕(헤더), 나눔명조(제목) 폰트를 명시적으로 등록하여 렌더링 품질 향상.

## 5. 향후 과제 및 인계 사항 (Pending / To-Do)

### ⚠️ 인계 시 주의사항
1. **플러그인 업데이트 필수**: `wordpress-plugin/jenny-daily-news.php`의 최신 버전(v1.8.2 이상)이 반드시 WordPress에 설치되어 있어야 탑뉴스 동기화가 작동합니다.
2. **폰트 파일 관리**: Vercel 배포 시 `public/fonts/` 경로에 `.ttf` 파일들이 포함되어 있는지 확인해야 합니다.
3. **카테고리 매핑**: `jenny-daily-news.php` 내부의 `$category_order` 배열을 수정하여 게시판 내 섹션 순서를 조정할 수 있습니다.

### 📋 남은 과제
- [ ] 탑뉴스 지정 시 Jenny 게시판에 즉시 반영되는지 최종 사용자 확인 대기.
- [ ] 카드뉴스 생성 시 특정 긴 제목이 영역을 벗어나는지 엣지 케이스 테스트 필요.

---
**이 시스템의 목표는 '오늘'이라는 시간에 갇히지 않고, 언제나 가장 최신의 뉴스가 살아 움직이는 게시판을 만드는 것입니다.**

